<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: "<projectfile>" -out "<projectname>.wixobj" <extensions> -dVersion=1.0.0.0 -dProjectDir=.\..\..\bin\release
    lightArgs: "<projectname>.wixobj" -out "<projectname>.msi" <extensions> -cultures:ru-ru
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" Language="1033" Manufacturer="Trustbox" Name="Rabnet $(var.Version)" Version="$(var.Version)" UpgradeCode="8F4BB748-14F8-47B7-8F35-C567F0A1B29A">
        <Package Description="Rabnet $(var.Version)" InstallerVersion="301" Compressed="yes" />
        <Upgrade Id="8F4BB748-14F8-47B7-8F35-C567F0A1B29A">
            <UpgradeVersion Minimum="$(var.Version)" IncludeMinimum="no" OnlyDetect="yes" Property="NEWERVERSIONDETECTED" />
            <UpgradeVersion Minimum="0.0.0" IncludeMinimum="yes" Maximum="$(var.Version)" IncludeMaximum="no" Property="OLDERVERSIONBEINGUPGRADED" />
        </Upgrade>
        <PropertyRef Id="NETFRAMEWORK20" />
		<Property Id="CMDEXE">cmd.exe</Property>
		<WixVariable Id="WixUILicenseRtf" Value="$(var.ProjectDir)\..\..\src\docs\licenseansi.rtf" />
        <Condition Message="Установлена более новая версия продукта"><![CDATA[NOT NEWERVERSIONDETECTED]]></Condition>
        <CustomAction Id="Property3Assign" Property="RABNETUPDATER" Value="[RabbitsDir]updater.exe" />
        <CustomAction Id="RabnetUpdate" Property="RABNETUPDATER" ExeCommand="" />
        <CustomAction Id="DeleteUpdater" Property="CMDEXE" ExeCommand="/C del &quot;[RABNETUPDATER]&quot;" />
        <InstallExecuteSequence>
            <RemoveExistingProducts After="InstallInitialize" />
            <Custom Action="Property3Assign" After="RemoveExistingProducts" />
			<Custom Action="RabnetUpdate" After="InstallFinalize">NOT Installed</Custom>
			<Custom Action="DeleteUpdater" After="RabnetUpdate">NOT Installed</Custom>
        </InstallExecuteSequence>
        <Condition Message="Для работы программы необходим .NET Framework 2.0 или более поздней версии, его можно получить на сайте www.microsoft.com .Установите .NET Framework, а потом перезапустите утановку данного продукта.">
			<![CDATA[Installed OR NETFRAMEWORK20]]>
		</Condition>
        <Media Id="1" Cabinet="rabnet.cab" EmbedCab="yes" />
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder" Name="PFiles">
                <Directory Id="RabbitsDir" Name="RabNet">
                    <Component Id="MainProgram" Guid="3D19CA32-71E7-4A06-B323-142F4C03DB42">
                        <File Id="rabnet.exe" Source="$(var.ProjectDir)\rabnet.exe" Checksum="yes" KeyPath="yes" />
                        <File Id="mia_conv.exe" Source="$(var.ProjectDir)\mia_conv.exe" Checksum="yes" />
                        <File Id="rabdump.exe" Source="$(var.ProjectDir)\rabdump.exe" Checksum="yes" />
                        <File Id="rabdump.exe.config" Source="$(var.ProjectDir)\rabdump.exe.config" Checksum="yes" />
                        <File Id="db.mysql.dll" Source="$(var.ProjectDir)\db.mysql.dll" Checksum="yes" />
                        <File Id="engine.dll" Source="$(var.ProjectDir)\engine.dll" Checksum="yes" />
                        <File Id="log4net.dll" Source="$(var.ProjectDir)\log4net.dll" Checksum="yes" />
                        <File Id="Mysql.Data.dll" Source="$(var.ProjectDir)\Mysql.Data.dll" Checksum="yes" />
                        <File Id="RdlEngine.dll" Source="$(var.ProjectDir)\RdlEngine.dll" Checksum="yes" />
                        <File Id="RdlViewer.dll" Source="$(var.ProjectDir)\RdlViewer.dll" Checksum="yes" />
                        <File Id="updater.exe" Source="$(var.ProjectDir)\..\tools\updater.exe" Checksum="yes" />
                    </Component>
                    <Directory Id="ReportsDir" Name="reports">
                        <Component Id="Reports" Guid="AF1369D3-6231-4FE8-8884-7ECDA59DE059">
                            <File Id="age.rdl" Source="$(var.ProjectDir)\reports\age.rdl" Checksum="yes" />
                            <File Id="breeds.rdl" Source="$(var.ProjectDir)\reports\breeds.rdl" Checksum="yes" />
                            <File Id="by_month.rdl" Source="$(var.ProjectDir)\reports\by_month.rdl" Checksum="yes" />
                            <File Id="dead.rdl" Source="$(var.ProjectDir)\reports\dead.rdl" Checksum="yes" />
                            <File Id="deadreason.rdl" Source="$(var.ProjectDir)\reports\deadreason.rdl" Checksum="yes" />
                            <File Id="empty_rev.rdl" Source="$(var.ProjectDir)\reports\empty_rev.rdl" Checksum="yes" />
                            <File Id="fucker.rdl" Source="$(var.ProjectDir)\reports\fucker.rdl" Checksum="yes" />
                            <File Id="fucks_by_date.rdl" Source="$(var.ProjectDir)\reports\fucks_by_date.rdl" Checksum="yes" />
                            <File Id="okrol_user.rdl" Source="$(var.ProjectDir)\reports\okrol_user.rdl" Checksum="yes" />
                            <File Id="plem.rdl" Source="$(var.ProjectDir)\reports\plem.rdl" Checksum="yes" />
                            <File Id="rabbit.rdl" Source="$(var.ProjectDir)\reports\rabbit.rdl" Checksum="yes" KeyPath="yes" />
                            <File Id="realization.rdl" Source="$(var.ProjectDir)\reports\realization.rdl" Checksum="yes" />
                            <File Id="replace_plan.rdl" Source="$(var.ProjectDir)\reports\replace_plan.rdl" Checksum="yes" />
                            <File Id="shed.rdl" Source="$(var.ProjectDir)\reports\shed.rdl" Checksum="yes" />
                            <File Id="zooteh.rdl" Source="$(var.ProjectDir)\reports\zooteh.rdl" Checksum="yes" />
                            <File Id="zooteh_nofuck.rdl" Source="$(var.ProjectDir)\reports\zooteh_nofuck.rdl" Checksum="yes" />
                        </Component>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder" Name="ProgramsMenu">
                <Directory Id="MenuDir" Name="Миакро">
                    <Component Id="MenuShortcuts" Guid="507B20FA-2868-4241-94D3-D8EDE75EAC9F">
                        <Shortcut Id="UninstallShortcut" Name="Удалить" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
                        <Shortcut Id="miaconvShortcut" Name="Импорт фермы" WorkingDirectory="RabbitsDir" Target="[RabbitsDir]mia_conv.exe" />
                        <Shortcut Id="rabnetShortcut" Name="Миакро rabnet" WorkingDirectory="RabbitsDir" Target="[RabbitsDir]rabnet.exe" />
                        <Shortcut Id="rabdumpShortcut" Name="Резервные копии" WorkingDirectory="RabbitsDir" Target="[RabbitsDir]rabdump.exe" />
                        <RemoveFolder Id="MenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\TrustBox\RabNet" Name="installed" Type="integer" Value="1" KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>
            <Directory Id="DesktopFolder">
                <Component Id="DesktopShortcuts" Guid="D7CA67CD-9F2B-43D6-B98A-C907BD09CE3D">
                    <Shortcut Id="rabnetDesktopShortcut" Name="Миакро rabnet" WorkingDirectory="RabbitsDir" Target="[RabbitsDir]rabnet.exe" />
                    <RegistryValue Root="HKCU" Key="Software\TrustBox\RabNet" Name="desktop" Type="integer" Value="1" KeyPath="yes" />
                </Component>
            </Directory>
        </Directory>
        <Feature Id="FullSetup" Level="1" Title="FullInstall">
            <ComponentRef Id="MainProgram" />
            <ComponentRef Id="Reports" />
            <ComponentRef Id="MenuShortcuts" />
            <ComponentRef Id="DesktopShortcuts" />
        </Feature>
        <UIRef Id="WixUI_Minimal" />
    </Product>
</Wix>